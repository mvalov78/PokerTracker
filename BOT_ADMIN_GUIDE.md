# 🤖 Руководство по управлению ботом через админку

> **Простое переключение между polling и webhook режимами**

## 🎯 Где находятся настройки

### **Доступ к управлению ботом:**
1. **Войдите как администратор** на сайт
2. **Перейдите в админ панель:** `/admin`
3. **Нажмите "🤖 Управление ботом"** или перейдите на `/admin/bot-management`

## 🔧 Интерфейс управления

### **📊 Панель статуса (вверху страницы):**
- **🔄/🔗 Режим работы** - текущий режим (Polling/Webhook)
- **✅/❌ Статус бота** - активен/неактивен/ошибка
- **⚠️ Ошибки за час** - счетчик проблем
- **🔄 Автоперезапуск** - включен/выключен

### **🔄 Polling режим (левая карточка):**
- **Описание:** Для разработки и отладки
- **Кнопка:** "🔄 Включить Polling"
- **Когда использовать:** Локальная разработка, отладка

### **🔗 Webhook режим (правая карточка):**
- **Поле URL:** Введите адрес webhook
- **Кнопка "🧪 Тест":** Проверить доступность URL
- **Кнопка "🔗 Включить Webhook":** Активировать режим
- **Когда использовать:** Продакшен на Vercel

## ⚡ Быстрые действия

### **🔄 Для локальной разработки:**
1. Откройте `/admin/bot-management`
2. Нажмите **"🔄 Включить Polling"**
3. Готово! Бот работает в polling режиме

### **🔗 Для продакшена на Vercel:**
1. Откройте `/admin/bot-management`
2. **Webhook URL:** `https://your-app.vercel.app/api/bot/webhook`
3. Нажмите **"🧪 Тест"** для проверки
4. Нажмите **"🔗 Включить Webhook"**
5. Готово! Бот работает в webhook режиме

## 🎮 Управляющие кнопки

| Кнопка | Функция | Когда использовать |
|--------|---------|-------------------|
| **🔄 Перезапуск** | Перезапускает бота | При проблемах или зависании |
| **🧹 Сбросить ошибки** | Обнуляет счетчик ошибок | После устранения проблем |
| **🧪 Тест Webhook** | Проверяет webhook endpoint | Перед включением webhook |
| **📊 Обновить** | Обновляет статус бота | Для получения актуальной информации |

## 🎯 Практические примеры

### **Пример 1: Настройка для Vercel продакшена**

```
1. Деплой: ./scripts/deploy-vercel.sh production 1.0.0
2. Админка: https://your-app.vercel.app/admin/bot-management
3. Webhook URL: https://your-app.vercel.app/api/bot/webhook
4. Тест: Нажать "🧪 Тест"
5. Активация: Нажать "🔗 Включить Webhook"
6. Проверка: Отправить /help боту в Telegram
```

### **Пример 2: Отладка проблем**

```
1. Если бот не отвечает:
   - Перейти в /admin/bot-management
   - Проверить статус (должен быть "Активен")
   - Если ошибка - нажать "🔄 Перезапуск"

2. Если много ошибок:
   - Временно включить "🔄 Polling" режим
   - Протестировать функциональность
   - Устранить проблемы
   - Вернуться на "🔗 Webhook"
```

### **Пример 3: Переключение с разработки на продакшен**

```
Разработка (localhost):
- Режим: 🔄 Polling
- Настройка: Просто нажать "Включить Polling"

Продакшен (Vercel):
- Режим: 🔗 Webhook  
- URL: https://your-domain.vercel.app/api/bot/webhook
- Настройка: Ввести URL → Тест → Включить Webhook
```

## ⚙️ Дополнительные настройки

### **Автоматический перезапуск:**
- **Включен** ✅ - бот автоматически перезапускается при ошибках
- **Выключен** ❌ - требует ручного вмешательства

**Рекомендация:** Всегда держите включенным для продакшена

## 🔍 Мониторинг

### **Что отслеживать:**
- **Статус:** Должен быть "Активен" зеленым цветом
- **Ошибки:** Не более 5-10 в час (нормально)
- **Последняя активность:** Не более 5 минут назад

### **Когда беспокоиться:**
- 🚨 **Статус "Ошибка"** красным цветом
- 🚨 **Более 20 ошибок** за час  
- 🚨 **Нет активности** более 10 минут
- 🚨 **Webhook недоступен** при тестировании

## 🆘 Решение проблем

### **Бот не отвечает:**
1. `/admin/bot-management` → Проверить статус
2. Если "Ошибка" → "🔄 Перезапуск"
3. Если не помогает → Переключить на Polling
4. Протестировать → Вернуться на Webhook

### **Webhook не работает:**
1. **"🧪 Тест"** webhook URL
2. Проверить что URL начинается с `https://`
3. Убедиться что endpoint доступен
4. При проблемах → временно Polling режим

### **Много ошибок:**
1. Проверить логи в Vercel Dashboard
2. **"🧹 Сбросить ошибки"** после исправления
3. Включить **автоперезапуск**
4. Мониторить следующие часы

## 🎯 Итоговая схема

```
Админ панель (/admin)
    ↓
"🤖 Управление ботом"  
    ↓
Страница управления (/admin/bot-management)
    ↓
┌─────────────────┬─────────────────┐
│  🔄 Polling     │  🔗 Webhook     │
│  Режим          │  Режим          │
│                 │                 │
│  [Включить]     │  URL: [______]  │
│                 │  [Тест] [Включ] │
└─────────────────┴─────────────────┘
    ↓
🎮 Управляющие кнопки:
[🔄 Перезапуск] [🧹 Сброс ошибок] [🧪 Тест] [📊 Обновить]
```

## ✅ Готово!

Теперь у вас есть **полноценная страница управления ботом** с:
- ✅ **Наглядным интерфейсом** переключения режимов
- ✅ **Автоматическим определением** webhook URL
- ✅ **Тестированием** endpoint перед активацией
- ✅ **Мониторингом** статуса в реальном времени
- ✅ **Управляющими кнопками** для всех операций

**🚀 Просто перейдите в `/admin/bot-management` и управляйте ботом!** 🤖
