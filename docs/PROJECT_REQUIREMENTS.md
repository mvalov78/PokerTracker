# Project Requirement Document: –¢—Ä–µ–∫–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–≥–æ –æ—Ñ—Ñ–ª–∞–π–Ω –ø–æ–∫–µ—Ä–∞

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

### 1.1 –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ Telegram-–±–æ—Ç–∞ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ñ—Ñ–ª–∞–π–Ω –ø–æ–∫–µ—Ä–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –±–∏–ª–µ—Ç–æ–≤ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏–≥—Ä–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

### 1.2 –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–∫–µ—Ä–∏—Å—Ç—ã
- –õ—é–±–∏—Ç–µ–ª–∏ –ø–æ–∫–µ—Ä–∞, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö
- –ü–æ–∫–µ—Ä–Ω—ã–µ –∫–ª—É–±—ã –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã —Ç—É—Ä–Ω–∏—Ä–æ–≤
- –ò–≥—Ä–æ–∫–∏, –∂–µ–ª–∞—é—â–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å ROI –∏ –±–∞–Ω–∫—Ä–æ–ª–ª-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç

## 2. –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### 2.1 Frontend
- **Next.js 14+** - React —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å App Router –¥–ª—è SSR –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **TypeScript** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞
- **Tailwind CSS** - utility-first CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
- **React Hook Form** - –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞–º–∏
- **TanStack Query** - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Ä–≤–µ—Ä–∞
- **Chart.js / Recharts** - –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **PWA (Progressive Web App)** - –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –æ–ø—ã—Ç–∞

### 2.2 Backend & Database
- **Supabase** - –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π –º–æ–∫ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –≤–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º Backend-as-a-Service –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–∫–ª—é—á–∞—é—â–∞—è:
  - **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  - **Auth** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - **Storage** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–∏–ª–µ—Ç–æ–≤
  - **Edge Functions** - –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏
  - **Real-time** - –¥–ª—è live –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **Prisma ORM** - –¥–ª—è —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Supabase
- **Supabase JS Client** - –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API

### 2.3 Telegram Bot
- **Telegraf.js** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤
- **Vercel Edge Functions** - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook'–æ–≤
- **Tesseract.js / Google Cloud Vision API** - –¥–ª—è OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- **Sharp** - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 2.4 –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Vercel** - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Vercel Edge Functions** - –¥–ª—è API endpoints –∏ Telegram bot
- **Vercel KV** - –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–µ—Å—Å–∏–π (Redis-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
- **Supabase Storage** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **Vercel Analytics** - –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 2.5 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Zod** - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **Jest + Testing Library** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **ESLint + Prettier** - –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

## 3. –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 3.1 –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ñ–æ—Ç–æ
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –≤—ã–∏–≥—Ä—ã—à–µ–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–∫—Ä–æ–ª–ª–æ–º
- ‚úÖ ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –±–æ—Ç–æ–º
- ‚úÖ –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (RU/EN)

### 3.2 –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- üìä –ì—Ä–∞—Ñ–∏–∫–∏ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- üì± Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- üîÑ Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Supabase
- üì∏ –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç—É—Ä–Ω–∏—Ä–æ–≤

## 4. –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 4.1 –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –°—Ç–∏–ª—å –∏ –¥–∏–∑–∞–π–Ω:
- **–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞**: –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –∞–∫—Ü–µ–Ω—Ç–∞–º–∏ –∑–µ–ª–µ–Ω–æ–≥–æ (#10B981) –∏ –∑–æ–ª–æ—Ç–æ–≥–æ (#F59E0B)
- **–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞**: Inter –∏–ª–∏ SF Pro Display –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: Rounded corners (8px), subtle shadows, gradient backgrounds
- **–ê–Ω–∏–º–∞—Ü–∏–∏**: Smooth transitions (0.2s ease), hover effects, loading states

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
```tsx
// app/auth/page.tsx - Next.js App Router
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs'
import { useState } from 'react'

export default function AuthPage() {
  const supabase = createClientComponentClient()
  const [isLogin, setIsLogin] = useState(true)
  const [isLoading, setIsLoading] = useState(false)

  const handleAuth = async (formData: FormData) => {
    setIsLoading(true)
    
    if (isLogin) {
      const { error } = await supabase.auth.signInWithPassword({
        email: formData.get('email') as string,
        password: formData.get('password') as string,
      })
    } else {
      const { error } = await supabase.auth.signUp({
        email: formData.get('email') as string,
        password: formData.get('password') as string,
        options: {
          data: {
            username: formData.get('username') as string,
          }
        }
      })
    }
    
    setIsLoading(false)
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
      <div className="flex items-center justify-center min-h-screen p-4">
        <div className="w-full max-w-md">
          {/* Logo Section */}
          <div className="text-center mb-8">
            <div className="inline-flex items-center justify-center w-16 h-16 bg-emerald-600 rounded-2xl mb-4">
              <span className="text-2xl">‚ô†Ô∏è</span>
            </div>
            <h1 className="text-3xl font-bold text-white mb-2">PokerTracker Pro</h1>
            <p className="text-gray-400">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø–æ–∫–µ—Ä–Ω—ã–π –ø—É—Ç—å</p>
          </div>

          {/* Auth Form */}
          <div className="bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20">
            <div className="flex mb-6 bg-gray-800/50 rounded-lg p-1">
              <button
                className={`flex-1 py-2 px-4 rounded-md transition-all ${
                  isLogin ? 'bg-emerald-600 text-white' : 'text-gray-400'
                }`}
                onClick={() => setIsLogin(true)}
              >
                –í—Ö–æ–¥
              </button>
              <button
                className={`flex-1 py-2 px-4 rounded-md transition-all ${
                  !isLogin ? 'bg-emerald-600 text-white' : 'text-gray-400'
                }`}
                onClick={() => setIsLogin(false)}
              >
                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
              </button>
            </div>

            <form action={handleAuth} className="space-y-4">
              <div>
                <input
                  type="email"
                  name="email"
                  placeholder="Email"
                  className="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
                  required
                />
              </div>
              
              {!isLogin && (
                <div>
                  <input
                    type="text"
                    name="username"
                    placeholder="–ù–∏–∫–Ω–µ–π–º"
                    className="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
                    required
                  />
                </div>
              )}
              
              <div>
                <input
                  type="password"
                  name="password"
                  placeholder="–ü–∞—Ä–æ–ª—å"
                  className="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
                  required
                />
              </div>

              <button
                type="submit"
                disabled={isLoading}
                className="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50"
              >
                {isLoading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : isLogin ? '–í–æ–π—Ç–∏' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è'}
              </button>
            </form>

            {/* Social Login */}
            <div className="mt-6 space-y-3">
              <button
                onClick={() => supabase.auth.signInWithOAuth({ provider: 'google' })}
                className="w-full py-3 bg-white text-gray-900 font-semibold rounded-lg hover:bg-gray-100 transition-colors flex items-center justify-center space-x-2"
              >
                <span>üîç</span>
                <span>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
```

### 4.2 –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (Dashboard)

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
```tsx
// app/dashboard/page.tsx
import { createServerComponentClient } from '@supabase/auth-helpers-nextjs'
import { cookies } from 'next/headers'
import { redirect } from 'next/navigation'
import DashboardClient from './DashboardClient'

export default async function DashboardPage() {
  const supabase = createServerComponentClient({ cookies })
  
  const { data: { session } } = await supabase.auth.getSession()
  if (!session) {
    redirect('/auth')
  }

  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è SSR
  const { data: tournaments } = await supabase
    .from('tournaments')
    .select(`
      *,
      tournament_results (*)
    `)
    .eq('user_id', session.user.id)
    .order('date', { ascending: false })
    .limit(5)

  const { data: stats } = await supabase
    .rpc('get_user_stats', { user_id: session.user.id })

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
                –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {session.user.user_metadata.username}
              </h1>
              <p className="text-gray-600 dark:text-gray-400 mt-1">
                –í–∞—à–∞ –ø–æ–∫–µ—Ä–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
              </p>
            </div>
            <div className="flex items-center space-x-4">
              <button className="p-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
                üîî
              </button>
            </div>
          </div>
        </div>

        {/* Quick Stats */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div className="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
            <div className="flex items-center">
              <div className="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                <span className="text-blue-600 dark:text-blue-400 text-xl">üé∞</span>
              </div>
              <div className="ml-4">
                <p className="text-sm text-gray-600 dark:text-gray-400">–¢—É—Ä–Ω–∏—Ä–æ–≤</p>
                <p className="text-2xl font-bold text-gray-900 dark:text-white">
                  {stats?.total_tournaments || 0}
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
            <div className="flex items-center">
              <div className="p-2 bg-emerald-100 dark:bg-emerald-900 rounded-lg">
                <span className="text-emerald-600 dark:text-emerald-400 text-xl">üí∞</span>
              </div>
              <div className="ml-4">
                <p className="text-sm text-gray-600 dark:text-gray-400">–í—ã–∏–≥—Ä–∞–Ω–æ</p>
                <p className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
                  ${stats?.total_winnings || 0}
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
            <div className="flex items-center">
              <div className="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
                <span className="text-purple-600 dark:text-purple-400 text-xl">üìà</span>
              </div>
              <div className="ml-4">
                <p className="text-sm text-gray-600 dark:text-gray-400">ROI</p>
                <p className={`text-2xl font-bold ${
                  (stats?.roi || 0) > 0 ? 'text-emerald-600' : 'text-red-600'
                }`}>
                  {stats?.roi || 0}%
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
            <div className="flex items-center">
              <div className="p-2 bg-amber-100 dark:bg-amber-900 rounded-lg">
                <span className="text-amber-600 dark:text-amber-400 text-xl">üèÜ</span>
              </div>
              <div className="ml-4">
                <p className="text-sm text-gray-600 dark:text-gray-400">ITM Rate</p>
                <p className="text-2xl font-bold text-gray-900 dark:text-white">
                  {stats?.itm_rate || 0}%
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Recent Tournaments */}
        <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm">
          <div className="p-6 border-b border-gray-200 dark:border-gray-700">
            <div className="flex items-center justify-between">
              <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä—ã
              </h2>
              <a
                href="/tournaments"
                className="text-emerald-600 hover:text-emerald-700 font-medium"
              >
                –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
              </a>
            </div>
          </div>
          <div className="p-6">
            <DashboardClient tournaments={tournaments} />
          </div>
        </div>

        {/* Floating Action Button */}
        <div className="fixed bottom-6 right-6">
          <a
            href="/tournaments/add"
            className="inline-flex items-center justify-center w-14 h-14 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all"
          >
            <span className="text-2xl">+</span>
          </a>
        </div>
      </div>
    </div>
  )
}
```

### 4.3 –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ —Å OCR

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
```tsx
// app/tournaments/add/page.tsx
'use client'
import { useState } from 'react'
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs'
import { useRouter } from 'next/navigation'

export default function AddTournamentPage() {
  const supabase = createClientComponentClient()
  const router = useRouter()
  const [currentStep, setCurrentStep] = useState(1)
  const [isProcessing, setIsProcessing] = useState(false)
  const [tournamentData, setTournamentData] = useState({})
  const [uploadedPhoto, setUploadedPhoto] = useState<string | null>(null)

  const handlePhotoUpload = async (file: File) => {
    if (!file) return

    setIsProcessing(true)
    
    try {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –≤ Supabase Storage
      const fileExt = file.name.split('.').pop()
      const fileName = `${Date.now()}.${fileExt}`
      const { data: uploadData, error: uploadError } = await supabase.storage
        .from('tournament-tickets')
        .upload(fileName, file)

      if (uploadError) throw uploadError

      // –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL
      const { data: { publicUrl } } = supabase.storage
        .from('tournament-tickets')
        .getPublicUrl(fileName)

      setUploadedPhoto(publicUrl)

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ OCR –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ Edge Function
      const response = await fetch('/api/ocr/process-ticket', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ imageUrl: publicUrl }),
      })

      const result = await response.json()

      if (result.success) {
        setTournamentData(result.data)
        setCurrentStep(2)
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—Ä—É—á–Ω—É—é
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –í–≤–µ–¥–∏—Ç–µ –∏—Ö –≤—Ä—É—á–Ω—É—é.')
        setCurrentStep(2)
      }
    } catch (error) {
      console.error('Error processing photo:', error)
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ')
    } finally {
      setIsProcessing(false)
    }
  }

  const saveTournament = async () => {
    try {
      const { data, error } = await supabase
        .from('tournaments')
        .insert({
          ...tournamentData,
          ticket_image_url: uploadedPhoto,
        })
        .select()
        .single()

      if (error) throw error

      router.push(`/tournaments/${data.id}`)
    } catch (error) {
      console.error('Error saving tournament:', error)
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞')
    }
  }

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900 py-8">
      <div className="max-w-2xl mx-auto px-4">
        {/* Progress Bar */}
        <div className="mb-8">
          <div className="flex items-center">
            {[1, 2, 3].map((step) => (
              <div key={step} className="flex items-center">
                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${
                  step <= currentStep 
                    ? 'bg-emerald-600 text-white' 
                    : 'bg-gray-300 text-gray-600'
                }`}>
                  {step}
                </div>
                {step < 3 && (
                  <div className={`w-16 h-1 mx-2 ${
                    step < currentStep ? 'bg-emerald-600' : 'bg-gray-300'
                  }`} />
                )}
              </div>
            ))}
          </div>
          <div className="mt-2 text-sm text-gray-600 dark:text-gray-400">
            –®–∞–≥ {currentStep} –∏–∑ 3
          </div>
        </div>

        {/* Step 1: Photo Upload */}
        {currentStep === 1 && (
          <div className="bg-white dark:bg-gray-800 rounded-xl p-8">
            <h2 className="text-2xl font-bold mb-6 text-center">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –±–∏–ª–µ—Ç–∞</h2>
            
            <div className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center">
              <input
                type="file"
                accept="image/*"
                onChange={(e) => e.target.files?.[0] && handlePhotoUpload(e.target.files[0])}
                className="hidden"
                id="photo-upload"
              />
              <label htmlFor="photo-upload" className="cursor-pointer">
                <div className="text-6xl mb-4">üì∏</div>
                <p className="text-lg font-medium mb-2">
                  –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ –±–∏–ª–µ—Ç–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞
                </p>
                <p className="text-gray-500">JPG, PNG –¥–æ 10MB</p>
              </label>
            </div>

            {isProcessing && (
              <div className="mt-6 text-center">
                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"></div>
                <p className="mt-2 text-gray-600">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–æ—Ç–æ...</p>
              </div>
            )}

            <div className="mt-6 text-center">
              <button
                onClick={() => setCurrentStep(2)}
                className="text-emerald-600 hover:text-emerald-700 font-medium"
              >
                –í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
              </button>
            </div>
          </div>
        )}

        {/* Step 2: Tournament Details */}
        {currentStep === 2 && (
          <div className="bg-white dark:bg-gray-800 rounded-xl p-8">
            <h2 className="text-2xl font-bold mb-6">–î–µ—Ç–∞–ª–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label className="block text-sm font-medium mb-2">
                  –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞ *
                </label>
                <input
                  type="text"
                  value={tournamentData.name || ''}
                  onChange={(e) => setTournamentData({...tournamentData, name: e.target.value})}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                  placeholder="Sunday Million"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è *
                </label>
                <input
                  type="datetime-local"
                  value={tournamentData.date || ''}
                  onChange={(e) => setTournamentData({...tournamentData, date: e.target.value})}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  –ë–∞–π-–∏–Ω ($) *
                </label>
                <input
                  type="number"
                  value={tournamentData.buyin || ''}
                  onChange={(e) => setTournamentData({...tournamentData, buyin: e.target.value})}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                  placeholder="100"
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
                </label>
                <input
                  type="text"
                  value={tournamentData.venue || ''}
                  onChange={(e) => setTournamentData({...tournamentData, venue: e.target.value})}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                  placeholder="PokerStars Casino"
                />
              </div>
            </div>

            <div className="flex justify-between mt-8">
              <button
                onClick={() => setCurrentStep(1)}
                className="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
              >
                –ù–∞–∑–∞–¥
              </button>
              <button
                onClick={() => setCurrentStep(3)}
                disabled={!tournamentData.name || !tournamentData.date || !tournamentData.buyin}
                className="px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50"
              >
                –î–∞–ª–µ–µ
              </button>
            </div>
          </div>
        )}

        {/* Step 3: Confirmation */}
        {currentStep === 3 && (
          <div className="bg-white dark:bg-gray-800 rounded-xl p-8">
            <h2 className="text-2xl font-bold mb-6">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            
            <div className="space-y-4">
              <div className="flex justify-between">
                <span className="font-medium">–¢—É—Ä–Ω–∏—Ä:</span>
                <span>{tournamentData.name}</span>
              </div>
              <div className="flex justify-between">
                <span className="font-medium">–î–∞—Ç–∞:</span>
                <span>{new Date(tournamentData.date).toLocaleString('ru-RU')}</span>
              </div>
              <div className="flex justify-between">
                <span className="font-medium">–ë–∞–π-–∏–Ω:</span>
                <span>${tournamentData.buyin}</span>
              </div>
              {tournamentData.venue && (
                <div className="flex justify-between">
                  <span className="font-medium">–ú–µ—Å—Ç–æ:</span>
                  <span>{tournamentData.venue}</span>
                </div>
              )}
            </div>

            <div className="flex justify-between mt-8">
              <button
                onClick={() => setCurrentStep(2)}
                className="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
              >
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
              </button>
              <button
                onClick={saveTournament}
                className="px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700"
              >
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  )
}
```

## 5. Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 5.1 –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Supabase

#### SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:
```sql
-- –í–∫–ª—é—á–µ–Ω–∏–µ Row Level Security
ALTER DATABASE postgres SET "app.jwt_secret" TO 'your-jwt-secret';

-- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è UUID
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ä–∞—Å—à–∏—Ä—è–µ—Ç auth.users)
CREATE TABLE public.profiles (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  username VARCHAR(100) UNIQUE,
  avatar_url TEXT,
  telegram_id BIGINT UNIQUE,
  preferences JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–æ–≤
CREATE TABLE public.tournaments (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  name VARCHAR(255) NOT NULL,
  date TIMESTAMP WITH TIME ZONE NOT NULL,
  venue VARCHAR(255),
  buyin DECIMAL(10,2) NOT NULL,
  tournament_type VARCHAR(50) DEFAULT 'freezeout',
  structure VARCHAR(50),
  participants INTEGER,
  prize_pool DECIMAL(12,2),
  blind_levels TEXT,
  starting_stack INTEGER,
  ticket_image_url TEXT,
  notes TEXT,
  status VARCHAR(20) DEFAULT 'registered',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç—É—Ä–Ω–∏—Ä–æ–≤
CREATE TABLE public.tournament_results (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  tournament_id UUID REFERENCES tournaments(id) ON DELETE CASCADE UNIQUE NOT NULL,
  position INTEGER NOT NULL,
  payout DECIMAL(10,2) DEFAULT 0,
  roi DECIMAL(8,4) GENERATED ALWAYS AS (
    CASE 
      WHEN (SELECT buyin FROM tournaments WHERE id = tournament_id) > 0 
      THEN ((payout - (SELECT buyin FROM tournaments WHERE id = tournament_id)) / (SELECT buyin FROM tournaments WHERE id = tournament_id)) * 100
      ELSE 0 
    END
  ) STORED,
  notes TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç—É—Ä–Ω–∏—Ä–æ–≤
CREATE TABLE public.tournament_photos (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  tournament_id UUID REFERENCES tournaments(id) ON DELETE CASCADE NOT NULL,
  photo_url TEXT NOT NULL,
  photo_type VARCHAR(20) DEFAULT 'general', -- 'ticket', 'result', 'general'
  caption TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE public.user_settings (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE NOT NULL,
  currency VARCHAR(3) DEFAULT 'USD',
  timezone VARCHAR(50) DEFAULT 'UTC',
  notifications JSONB DEFAULT '{"telegram": true, "email": false}',
  privacy JSONB DEFAULT '{"profile_public": false}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Row Level Security Policies
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE tournaments ENABLE ROW LEVEL SECURITY;
ALTER TABLE tournament_results ENABLE ROW LEVEL SECURITY;
ALTER TABLE tournament_photos ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_settings ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è profiles
CREATE POLICY "Users can view own profile" ON profiles FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Users can update own profile" ON profiles FOR UPDATE USING (auth.uid() = id);
CREATE POLICY "Users can insert own profile" ON profiles FOR INSERT WITH CHECK (auth.uid() = id);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è tournaments
CREATE POLICY "Users can view own tournaments" ON tournaments FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own tournaments" ON tournaments FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can update own tournaments" ON tournaments FOR UPDATE USING (auth.uid() = user_id);
CREATE POLICY "Users can delete own tournaments" ON tournaments FOR DELETE USING (auth.uid() = user_id);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è tournament_results
CREATE POLICY "Users can view own results" ON tournament_results FOR SELECT USING (
  auth.uid() = (SELECT user_id FROM tournaments WHERE id = tournament_id)
);
CREATE POLICY "Users can insert own results" ON tournament_results FOR INSERT WITH CHECK (
  auth.uid() = (SELECT user_id FROM tournaments WHERE id = tournament_id)
);
CREATE POLICY "Users can update own results" ON tournament_results FOR UPDATE USING (
  auth.uid() = (SELECT user_id FROM tournaments WHERE id = tournament_id)
);
CREATE POLICY "Users can delete own results" ON tournament_results FOR DELETE USING (
  auth.uid() = (SELECT user_id FROM tournaments WHERE id = tournament_id)
);

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION get_user_stats(user_id UUID)
RETURNS JSON AS $$
DECLARE
  result JSON;
BEGIN
  SELECT json_build_object(
    'total_tournaments', COUNT(t.id),
    'total_buyin', COALESCE(SUM(t.buyin), 0),
    'total_winnings', COALESCE(SUM(tr.payout), 0),
    'profit', COALESCE(SUM(tr.payout - t.buyin), 0),
    'roi', CASE 
      WHEN SUM(t.buyin) > 0 THEN 
        ROUND(((SUM(tr.payout) - SUM(t.buyin)) / SUM(t.buyin) * 100)::numeric, 2)
      ELSE 0 
    END,
    'itm_rate', CASE 
      WHEN COUNT(t.id) > 0 THEN 
        ROUND((COUNT(tr.id) * 100.0 / COUNT(t.id))::numeric, 2)
      ELSE 0 
    END,
    'best_position', MIN(tr.position),
    'best_payout', MAX(tr.payout),
    'first_tournament', MIN(t.date),
    'last_tournament', MAX(t.date)
  ) INTO result
  FROM tournaments t
  LEFT JOIN tournament_results tr ON t.id = tr.tournament_id
  WHERE t.user_id = get_user_stats.user_id;
  
  RETURN result;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_tournaments_user_id ON tournaments(user_id);
CREATE INDEX idx_tournaments_date ON tournaments(date);
CREATE INDEX idx_tournament_results_tournament_id ON tournament_results(tournament_id);
CREATE INDEX idx_profiles_telegram_id ON profiles(telegram_id);

-- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_tournaments_updated_at BEFORE UPDATE ON tournaments
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_profiles_updated_at BEFORE UPDATE ON profiles
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_user_settings_updated_at BEFORE UPDATE ON user_settings
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

### 5.2 Supabase Storage –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –°–æ–∑–¥–∞–Ω–∏–µ buckets –¥–ª—è —Ñ–∞–π–ª–æ–≤:
```sql
-- Bucket –¥–ª—è –±–∏–ª–µ—Ç–æ–≤ —Ç—É—Ä–Ω–∏—Ä–æ–≤
INSERT INTO storage.buckets (id, name, public) VALUES ('tournament-tickets', 'tournament-tickets', true);

-- Bucket –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç—É—Ä–Ω–∏—Ä–æ–≤
INSERT INTO storage.buckets (id, name, public) VALUES ('tournament-photos', 'tournament-photos', true);

-- Bucket –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
INSERT INTO storage.buckets (id, name, public) VALUES ('avatars', 'avatars', true);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è tournament-tickets bucket
CREATE POLICY "Users can upload own tournament tickets" ON storage.objects FOR INSERT WITH CHECK (
  bucket_id = 'tournament-tickets' AND auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Users can view own tournament tickets" ON storage.objects FOR SELECT USING (
  bucket_id = 'tournament-tickets' AND auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Users can delete own tournament tickets" ON storage.objects FOR DELETE USING (
  bucket_id = 'tournament-tickets' AND auth.uid()::text = (storage.foldername(name))[1]
);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è tournament-photos bucket
CREATE POLICY "Users can upload tournament photos" ON storage.objects FOR INSERT WITH CHECK (
  bucket_id = 'tournament-photos' AND auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Users can view tournament photos" ON storage.objects FOR SELECT USING (
  bucket_id = 'tournament-photos' AND auth.uid()::text = (storage.foldername(name))[1]
);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è avatars bucket
CREATE POLICY "Users can upload own avatar" ON storage.objects FOR INSERT WITH CHECK (
  bucket_id = 'avatars' AND auth.uid()::text = (storage.foldername(name))[1]
);

CREATE POLICY "Anyone can view avatars" ON storage.objects FOR SELECT USING (
  bucket_id = 'avatars'
);
```

## 6. Vercel Edge Functions –¥–ª—è Telegram Bot

### 6.1 Telegram Webhook Handler

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
```typescript
// api/telegram/webhook.ts - Vercel Edge Function
import { NextRequest } from 'next/server'
import { Telegraf } from 'telegraf'
import { createClient } from '@supabase/supabase-js'

const bot = new Telegraf(process.env.TELEGRAM_BOT_TOKEN!)
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
)

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
bot.command('start', async (ctx) => {
  const telegramId = ctx.from.id
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–≤—è–∑–∞–Ω –ª–∏ —É–∂–µ –∞–∫–∫–∞—É–Ω—Ç
  const { data: profile } = await supabase
    .from('profiles')
    .select('*')
    .eq('telegram_id', telegramId)
    .single()

  if (profile) {
    await ctx.reply(
      `üé∞ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PokerTracker Pro!\n\n` +
      `–í–∞—à –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω.\n\n` +
      `–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n` +
      `/add_tournament - –î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä\n` +
      `/my_tournaments - –ú–æ–∏ —Ç—É—Ä–Ω–∏—Ä—ã\n` +
      `/add_result - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n` +
      `/stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞`,
      {
        reply_markup: {
          keyboard: [
            [{ text: 'üé∞ –î–æ–±–∞–≤–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä' }, { text: 'üèÜ –ú–æ–∏ —Ç—É—Ä–Ω–∏—Ä—ã' }],
            [{ text: 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞' }, { text: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏' }]
          ],
          resize_keyboard: true
        }
      }
    )
  } else {
    const linkCode = generateLinkCode()
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Vercel KV)
    await kv.set(`link_code:${linkCode}`, telegramId, { ex: 300 }) // 5 –º–∏–Ω—É—Ç
    
    await ctx.reply(
      `üé∞ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PokerTracker Pro!\n\n` +
      `–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–≤—è–∂–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç:\n\n` +
      `1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç: ${process.env.NEXT_PUBLIC_APP_URL}/link-telegram\n` +
      `2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥: \`${linkCode}\`\n\n` +
      `–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 5 –º–∏–Ω—É—Ç.`,
      { parse_mode: 'Markdown' }
    )
  }
})

bot.command('add_tournament', async (ctx) => {
  await ctx.reply(
    'üé∞ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç—É—Ä–Ω–∏—Ä–∞\n\n' +
    '–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –±–∏–ª–µ—Ç–∞ —Ç—É—Ä–Ω–∏—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è ' +
    '–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é".',
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: '‚úçÔ∏è –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é', callback_data: 'manual_input' }],
          [{ text: '‚ùå –û—Ç–º–µ–Ω–∞', callback_data: 'cancel' }]
        ]
      }
    }
  )
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è —Ñ–æ—Ç–æ
  await kv.set(`user_state:${ctx.from.id}`, 'waiting_photo', { ex: 300 })
})

bot.on('photo', async (ctx) => {
  const userState = await kv.get(`user_state:${ctx.from.id}`)
  
  if (userState !== 'waiting_photo') {
    return
  }
  
  await ctx.reply('üì∏ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ñ–æ—Ç–æ –±–∏–ª–µ—Ç–∞...')
  
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª –∏–∑ Telegram
    const fileId = ctx.message.photo[ctx.message.photo.length - 1].file_id
    const file = await ctx.telegram.getFile(fileId)
    const fileUrl = `https://api.telegram.org/file/bot${process.env.TELEGRAM_BOT_TOKEN}/${file.file_path}`
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    const response = await fetch(fileUrl)
    const imageBuffer = await response.arrayBuffer()
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ Supabase Storage
    const fileName = `${ctx.from.id}/${Date.now()}.jpg`
    const { data: uploadData, error } = await supabase.storage
      .from('tournament-tickets')
      .upload(fileName, imageBuffer, {
        contentType: 'image/jpeg'
      })
    
    if (error) throw error
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL
    const { data: { publicUrl } } = supabase.storage
      .from('tournament-tickets')
      .getPublicUrl(fileName)
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º OCR
    const ocrResult = await processOCR(publicUrl)
    
    if (ocrResult.success) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      await kv.set(`tournament_data:${ctx.from.id}`, JSON.stringify(ocrResult.data), { ex: 600 })
      
      await ctx.reply(
        '‚úÖ *–î–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!*\n\n' +
        `üèÜ *–¢—É—Ä–Ω–∏—Ä:* ${ocrResult.data.name}\n` +
        `üìÖ *–î–∞—Ç–∞:* ${formatDate(ocrResult.data.date)}\n` +
        `üí∞ *–ë–∞–π-–∏–Ω:* $${ocrResult.data.buyin}\n` +
        `üìç *–ú–µ—Å—Ç–æ:* ${ocrResult.data.venue || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n\n` +
        '–î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã?',
        {
          parse_mode: 'Markdown',
          reply_markup: {
            inline_keyboard: [
              [
                { text: '‚úÖ –î–∞, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å', callback_data: 'confirm_tournament' },
                { text: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', callback_data: 'edit_tournament' }
              ],
              [{ text: '‚ùå –û—Ç–º–µ–Ω–∞', callback_data: 'cancel' }]
            ]
          }
        }
      )
    } else {
      await ctx.reply(
        '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Ñ–æ—Ç–æ.\n' +
        '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ –ø–æ–ª—É—á—à–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é.',
        {
          reply_markup: {
            inline_keyboard: [
              [{ text: '‚úçÔ∏è –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é', callback_data: 'manual_input' }],
              [{ text: 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑', callback_data: 'retry_photo' }]
            ]
          }
        }
      )
    }
  } catch (error) {
    console.error('Error processing photo:', error)
    await ctx.reply('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.')
  } finally {
    await kv.del(`user_state:${ctx.from.id}`)
  }
})

bot.action('confirm_tournament', async (ctx) => {
  try {
    const tournamentDataStr = await kv.get(`tournament_data:${ctx.from.id}`)
    if (!tournamentDataStr) {
      await ctx.reply('‚ùå –î–∞–Ω–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.')
      return
    }
    
    const tournamentData = JSON.parse(tournamentDataStr as string)
    
    // –ü–æ–ª—É—á–∞–µ–º user_id –ø–æ telegram_id
    const { data: profile } = await supabase
      .from('profiles')
      .select('id')
      .eq('telegram_id', ctx.from.id)
      .single()
    
    if (!profile) {
      await ctx.reply('‚ùå –ê–∫–∫–∞—É–Ω—Ç –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start')
      return
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—É—Ä–Ω–∏—Ä –≤ –±–∞–∑—É
    const { data: tournament, error } = await supabase
      .from('tournaments')
      .insert({
        user_id: profile.id,
        name: tournamentData.name,
        date: tournamentData.date,
        buyin: tournamentData.buyin,
        venue: tournamentData.venue,
        ticket_image_url: tournamentData.imageUrl
      })
      .select()
      .single()
    
    if (error) throw error
    
    await ctx.reply(
      'üéâ *–¢—É—Ä–Ω–∏—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!*\n\n' +
      `–ù–∞–∑–≤–∞–Ω–∏–µ: ${tournament.name}\n\n` +
      '–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ–π—á–∞—Å?',
      {
        parse_mode: 'Markdown',
        reply_markup: {
          inline_keyboard: [
            [{ text: 'üèÜ –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç', callback_data: `add_result_${tournament.id}` }],
            [{ text: 'üìä –ú–æ–∏ —Ç—É—Ä–Ω–∏—Ä—ã', callback_data: 'my_tournaments' }]
          ]
        }
      }
    )
    
    // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    await kv.del(`tournament_data:${ctx.from.id}`)
    
  } catch (error) {
    console.error('Error saving tournament:', error)
    await ctx.reply('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç—É—Ä–Ω–∏—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.')
  }
})

// –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook
export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    await bot.handleUpdate(body)
    return new Response('OK', { status: 200 })
  } catch (error) {
    console.error('Webhook error:', error)
    return new Response('Error', { status: 500 })
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function generateLinkCode(): string {
  return Math.random().toString(36).substring(2, 8).toUpperCase()
}

async function processOCR(imageUrl: string) {
  // –ó–¥–µ—Å—å –≤—ã–∑—ã–≤–∞–µ–º OCR —Å–µ—Ä–≤–∏—Å
  try {
    const response = await fetch('/api/ocr/process-ticket', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ imageUrl })
    })
    
    return await response.json()
  } catch (error) {
    return { success: false, error: error.message }
  }
}

function formatDate(dateString: string): string {
  return new Date(dateString).toLocaleDateString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  })
}
```

### 6.2 OCR Processing Edge Function

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
```typescript
// api/ocr/process-ticket.ts
import { NextRequest } from 'next/server'
import Tesseract from 'tesseract.js'

export const runtime = 'edge'

interface OCRResult {
  success: boolean
  data?: any
  error?: string
  confidence?: number
}

export async function POST(request: NextRequest) {
  try {
    const { imageUrl } = await request.json()
    
    if (!imageUrl) {
      return Response.json({ success: false, error: 'Image URL required' }, { status: 400 })
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    const imageResponse = await fetch(imageUrl)
    const imageBuffer = await imageResponse.arrayBuffer()
    
    // OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å Tesseract.js
    const { data: { text, confidence } } = await Tesseract.recognize(
      Buffer.from(imageBuffer),
      'eng+rus',
      {
        logger: m => console.log(m)
      }
    )
    
    if (confidence < 70) {
      return Response.json({
        success: false,
        error: 'Low confidence OCR result',
        confidence
      })
    }
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞
    const extractedData = extractTournamentData(text)
    
    if (!extractedData.name && !extractedData.buyin) {
      return Response.json({
        success: false,
        error: 'Could not extract tournament data',
        confidence,
        rawText: text
      })
    }
    
    return Response.json({
      success: true,
      data: {
        ...extractedData,
        imageUrl
      },
      confidence
    })
    
  } catch (error) {
    console.error('OCR processing error:', error)
    return Response.json({
      success: false,
      error: 'OCR processing failed'
    }, { status: 500 })
  }
}

function extractTournamentData(ocrText: string) {
  const patterns = {
    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞
    name: [
      /tournament[:\s]+([^\n\r]+)/i,
      /event[:\s]+([^\n\r]+)/i,
      /—Ç—É—Ä–Ω–∏—Ä[:\s]+([^\n\r]+)/i,
      /–Ω–∞–∑–≤–∞–Ω–∏–µ[:\s]+([^\n\r]+)/i
    ],
    
    // –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
    date: [
      /(\d{1,2}[\/\-\.]\d{1,2}[\/\-\.]\d{2,4})/,
      /(\d{2,4}[\/\-\.]\d{1,2}[\/\-\.]\d{1,2})/,
      /date[:\s]+([^\n\r]+)/i,
      /–¥–∞—Ç–∞[:\s]+([^\n\r]+)/i
    ],
    
    // –ë–∞–π-–∏–Ω
    buyin: [
      /buy[\-\s]*in[:\s]*\$?(\d+(?:[,\.]\d+)?)/i,
      /entry[:\s]*\$?(\d+(?:[,\.]\d+)?)/i,
      /–≤–∑–Ω–æ—Å[:\s]*\$?(\d+(?:[,\.]\d+)?)/i,
      /\$(\d+(?:[,\.]\d+)?)/
    ],
    
    // –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
    venue: [
      /venue[:\s]+([^\n\r]+)/i,
      /location[:\s]+([^\n\r]+)/i,
      /casino[:\s]+([^\n\r]+)/i,
      /–º–µ—Å—Ç–æ[:\s]+([^\n\r]+)/i
    ]
  }
  
  const extractedData: any = {}
  
  // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
  for (const [field, fieldPatterns] of Object.entries(patterns)) {
    for (const pattern of fieldPatterns) {
      const match = ocrText.match(pattern)
      if (match && match[1]) {
        extractedData[field] = match[1].trim()
        break
      }
    }
  }
  
  // –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
  if (extractedData.buyin) {
    extractedData.buyin = parseFloat(extractedData.buyin.replace(/[,\s]/g, ''))
  }
  
  if (extractedData.date) {
    extractedData.date = parseDate(extractedData.date)
  }
  
  return extractedData
}

function parseDate(dateString: string): string {
  try {
    // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç
    const formats = [
      /(\d{1,2})[\/\-\.](\d{1,2})[\/\-\.](\d{2,4})/,
      /(\d{2,4})[\/\-\.](\d{1,2})[\/\-\.](\d{1,2})/
    ]
    
    for (const format of formats) {
      const match = dateString.match(format)
      if (match) {
        const [, part1, part2, part3] = match
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∏ —Å–æ–∑–¥–∞–µ–º –¥–∞—Ç—É
        let date: Date
        if (part3.length === 4) {
          // –ì–æ–¥ –≤ –∫–æ–Ω—Ü–µ: DD/MM/YYYY –∏–ª–∏ MM/DD/YYYY
          date = new Date(parseInt(part3), parseInt(part2) - 1, parseInt(part1))
        } else {
          // –ì–æ–¥ –≤ –Ω–∞—á–∞–ª–µ: YYYY/MM/DD
          date = new Date(parseInt(part1), parseInt(part2) - 1, parseInt(part3))
        }
        
        if (!isNaN(date.getTime())) {
          return date.toISOString()
        }
      }
    }
    
    // Fallback: –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
    const date = new Date(dateString)
    if (!isNaN(date.getTime())) {
      return date.toISOString()
    }
    
    return new Date().toISOString() // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∫–∞–∫ fallback
  } catch (error) {
    return new Date().toISOString()
  }
}
```

## 7. Prisma –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Supabase

### 7.1 Schema.prisma –¥–ª—è Supabase

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Profile {
  id          String   @id @db.Uuid
  username    String?  @unique
  avatarUrl   String?  @map("avatar_url")
  telegramId  BigInt?  @unique @map("telegram_id")
  preferences Json     @default("{}")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  tournaments Tournament[]
  settings    UserSettings?

  @@map("profiles")
}

model Tournament {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId           String    @map("user_id") @db.Uuid
  name             String
  date             DateTime  @db.Timestamptz(6)
  venue            String?
  buyin            Decimal   @db.Decimal(10, 2)
  tournamentType   String    @default("freezeout") @map("tournament_type")
  structure        String?
  participants     Int?
  prizePool        Decimal?  @map("prize_pool") @db.Decimal(12, 2)
  blindLevels      String?   @map("blind_levels")
  startingStack    Int?      @map("starting_stack")
  ticketImageUrl   String?   @map("ticket_image_url")
  notes            String?
  status           String    @default("registered")
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  profile Profile             @relation(fields: [userId], references: [id], onDelete: Cascade)
  result  TournamentResult?
  photos  TournamentPhoto[]

  @@map("tournaments")
}

model TournamentResult {
  id           String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tournamentId String   @unique @map("tournament_id") @db.Uuid
  position     Int
  payout       Decimal  @default(0) @db.Decimal(10, 2)
  notes        String?
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@map("tournament_results")
}

model TournamentPhoto {
  id           String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tournamentId String   @map("tournament_id") @db.Uuid
  photoUrl     String   @map("photo_url")
  photoType    String   @default("general") @map("photo_type")
  caption      String?
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  tournament Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@map("tournament_photos")
}

model UserSettings {
  id            String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId        String   @unique @map("user_id") @db.Uuid
  currency      String   @default("USD")
  timezone      String   @default("UTC")
  notifications Json     @default("{\"telegram\": true, \"email\": false}")
  privacy       Json     @default("{\"profile_public\": false}")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  profile Profile @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}
```

### 7.2 Supabase Client –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
```typescript
// lib/supabase.ts
import { createClientComponentClient, createServerComponentClient } from '@supabase/auth-helpers-nextjs'
import { createClient } from '@supabase/supabase-js'
import { cookies } from 'next/headers'

// –¢–∏–ø—ã –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
export type Database = {
  public: {
    Tables: {
      profiles: {
        Row: {
          id: string
          username: string | null
          avatar_url: string | null
          telegram_id: number | null
          preferences: Json
          created_at: string
          updated_at: string
        }
        Insert: {
          id: string
          username?: string | null
          avatar_url?: string | null
          telegram_id?: number | null
          preferences?: Json
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          username?: string | null
          avatar_url?: string | null
          telegram_id?: number | null
          preferences?: Json
          created_at?: string
          updated_at?: string
        }
      }
      tournaments: {
        Row: {
          id: string
          user_id: string
          name: string
          date: string
          venue: string | null
          buyin: number
          tournament_type: string
          structure: string | null
          participants: number | null
          prize_pool: number | null
          blind_levels: string | null
          starting_stack: number | null
          ticket_image_url: string | null
          notes: string | null
          status: string
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          user_id: string
          name: string
          date: string
          venue?: string | null
          buyin: number
          tournament_type?: string
          structure?: string | null
          participants?: number | null
          prize_pool?: number | null
          blind_levels?: string | null
          starting_stack?: number | null
          ticket_image_url?: string | null
          notes?: string | null
          status?: string
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          user_id?: string
          name?: string
          date?: string
          venue?: string | null
          buyin?: number
          tournament_type?: string
          structure?: string | null
          participants?: number | null
          prize_pool?: number | null
          blind_levels?: string | null
          starting_stack?: number | null
          ticket_image_url?: string | null
          notes?: string | null
          status?: string
          created_at?: string
          updated_at?: string
        }
      }
      // ... –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    }
    Functions: {
      get_user_stats: {
        Args: { user_id: string }
        Returns: Json
      }
    }
  }
}

// Client-side –∫–ª–∏–µ–Ω—Ç
export const createClient = () => createClientComponentClient<Database>()

// Server-side –∫–ª–∏–µ–Ω—Ç
export const createServerClient = () => createServerComponentClient<Database>({ cookies })

// Service role –∫–ª–∏–µ–Ω—Ç (–¥–ª—è Edge Functions)
export const createServiceClient = () => createClient<Database>(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
)

// Middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
export async function getUser() {
  const supabase = createServerClient()
  const { data: { user } } = await supabase.auth.getUser()
  return user
}

// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Storage
export const uploadImage = async (
  bucket: string,
  path: string,
  file: File | Buffer,
  options?: { contentType?: string }
) => {
  const supabase = createClient()
  
  const { data, error } = await supabase.storage
    .from(bucket)
    .upload(path, file, {
      cacheControl: '3600',
      upsert: false,
      ...options
    })
  
  if (error) throw error
  
  const { data: { publicUrl } } = supabase.storage
    .from(bucket)
    .getPublicUrl(path)
  
  return { data, publicUrl }
}

// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
export const getProfile = async (userId: string) => {
  const supabase = createClient()
  
  const { data, error } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', userId)
    .single()
  
  if (error) throw error
  return data
}

export const updateProfile = async (userId: string, updates: Database['public']['Tables']['profiles']['Update']) => {
  const supabase = createClient()
  
  const { data, error } = await supabase
    .from('profiles')
    .update(updates)
    .eq('id', userId)
    .select()
    .single()
  
  if (error) throw error
  return data
}

// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—É—Ä–Ω–∏—Ä–∞–º–∏
export const getUserTournaments = async (userId: string, limit = 20, offset = 0) => {
  const supabase = createClient()
  
  const { data, error } = await supabase
    .from('tournaments')
    .select(`
      *,
      tournament_results (*)
    `)
    .eq('user_id', userId)
    .order('date', { ascending: false })
    .range(offset, offset + limit - 1)
  
  if (error) throw error
  return data
}

export const createTournament = async (tournament: Database['public']['Tables']['tournaments']['Insert']) => {
  const supabase = createClient()
  
  const { data, error } = await supabase
    .from('tournaments')
    .insert(tournament)
    .select()
    .single()
  
  if (error) throw error
  return data
}

// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
export const getUserStats = async (userId: string) => {
  const supabase = createClient()
  
  const { data, error } = await supabase
    .rpc('get_user_stats', { user_id: userId })
  
  if (error) throw error
  return data
}
```

## 8. Vercel –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 8.1 Vercel.json –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```json
{
  "functions": {
    "api/telegram/webhook.ts": {
      "runtime": "edge"
    },
    "api/ocr/process-ticket.ts": {
      "runtime": "edge"
    }
  },
  "env": {
    "NEXT_PUBLIC_SUPABASE_URL": "@supabase-url",
    "NEXT_PUBLIC_SUPABASE_ANON_KEY": "@supabase-anon-key",
    "SUPABASE_SERVICE_ROLE_KEY": "@supabase-service-key",
    "TELEGRAM_BOT_TOKEN": "@telegram-bot-token",
    "DATABASE_URL": "@database-url",
    "DIRECT_URL": "@direct-url"
  },
  "build": {
    "env": {
      "NEXT_PUBLIC_SUPABASE_URL": "@supabase-url",
      "NEXT_PUBLIC_SUPABASE_ANON_KEY": "@supabase-anon-key"
    }
  }
}
```

### 8.2 Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    appDir: true,
  },
  images: {
    domains: [
      'your-supabase-project.supabase.co',
      'api.telegram.org'
    ],
  },
  env: {
    NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',
  },
}

module.exports = nextConfig
```

### 8.3 Environment Variables

```bash
# .env.local –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres
DIRECT_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres

# Telegram
TELEGRAM_BOT_TOKEN=your-bot-token
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app

# Vercel KV (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
KV_URL=your-kv-url
KV_REST_API_URL=your-kv-rest-url
KV_REST_API_TOKEN=your-kv-token
KV_REST_API_READ_ONLY_TOKEN=your-kv-readonly-token
```

## 9. Deployment Pipeline

### 9.1 GitHub Actions –¥–ª—è CI/CD

```yaml
# .github/workflows/deploy.yml
name: Deploy to Vercel

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm run test
        env:
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}
      
      - name: Run Prisma generate
        run: npx prisma generate
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
      
      - name: Deploy to Vercel
        uses: vercel/action@v1
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-args: '--prod'
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
      
      - name: Set Telegram Webhook
        if: github.ref == 'refs/heads/main'
        run: |
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/setWebhook" \
            -H "Content-Type: application/json" \
            -d '{"url": "https://your-app.vercel.app/api/telegram/webhook"}'
```

## 10. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### 10.1 Vercel Analytics –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react'
import { SpeedInsights } from '@vercel/speed-insights/next'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="ru">
      <body>
        {children}
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  )
}
```

### 10.2 Error Tracking

```typescript
// lib/error-tracking.ts
export function trackError(error: Error, context?: Record<string, any>) {
  // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry –∏–ª–∏ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–æ–º
  console.error('Application Error:', error, context)
  
  // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Supabase –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  if (typeof window !== 'undefined') {
    fetch('/api/errors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: error.message,
        stack: error.stack,
        context,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href
      })
    }).catch(console.error)
  }
}
```

## 11. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π Supabase –∏ Vercel, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase:
- üóÑÔ∏è **Managed PostgreSQL** - –Ω–∞–¥–µ–∂–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- üîê **Built-in Auth** - –≥–æ—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- üìÅ **Storage** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤ —Å CDN
- ‚ö° **Real-time** - –∂–∏–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- üõ°Ô∏è **Row Level Security** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫
- üîß **Edge Functions** - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–ª–∏–∑–∫–æ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Vercel:
- üöÄ **Zero Config Deployment** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–∑ Git
- üåç **Global CDN** - –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É
- ‚ö° **Edge Functions** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ç–∏
- üìä **Built-in Analytics** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üîÑ **Preview Deployments** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–≤—å—é –¥–ª—è PR
- üíæ **Vercel KV** - Redis-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
- **Frontend**: Next.js 14 + TypeScript + Tailwind CSS
- **Backend**: Supabase (PostgreSQL + Auth + Storage + Edge Functions)
- **Deployment**: Vercel —Å Edge Functions
- **Bot**: Telegraf.js —Å Vercel Edge Functions
- **OCR**: Tesseract.js + Google Cloud Vision API
- **Caching**: Vercel KV (Redis)
- **Monitoring**: Vercel Analytics + Speed Insights

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω –±–ª–∞–≥–æ–¥–∞—Ä—è serverless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Vercel –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º —Å–µ—Ä–≤–∏—Å–∞–º Supabase.


