# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Telegram –±–æ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (Webhook —Ä–µ–∂–∏–º)

**–î–∞—Ç–∞:** 16 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω **webhook —Ä–µ–∂–∏–º** –¥–ª—è Telegram –±–æ—Ç–∞, –Ω–æ:
- –ë–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/bot` –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ **–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–π** —Å—Ç–∞—Ç—É—Å "Polling —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω"
- –ù–µ –±—ã–ª–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
- –ù–µ –±—ã–ª–æ API endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ webhook –æ—Ç Telegram

## –†–µ—à–µ–Ω–∏–µ

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω API endpoint –¥–ª—è webhook –æ—Ç Telegram

**–§–∞–π–ª:** `src/app/api/telegram/webhook/route.ts`

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Telegram —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è Telegram API
- –ò–º–µ–µ—Ç GET endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### 2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞

**–§–∞–π–ª:** `src/app/admin/bot/page.tsx`

**–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üîÑ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞ –∏–∑ –ë–î –∏ Telegram API
- üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã (polling/webhook)
- üîó –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π webhook (URL, –æ—à–∏–±–∫–∏, –æ–∂–∏–¥–∞—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- üîÑ –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
- üîÑ –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
```
üì° –°—Ç–∞—Ç—É—Å –ë–æ—Ç–∞
üîó Webhook —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω
   –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ webhook

–†–µ–∂–∏–º: Webhook
–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω
Webhook URL: https://your-app.vercel.app/api/telegram/webhook
```

### 3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `env.example`

```bash
# Telegram Bot Configuration
BOT_MODE=polling                    # "polling" –∏–ª–∏ "webhook"
BOT_WEBHOOK_URL=                    # URL –¥–ª—è webhook
BOT_AUTO_RESTART=true               # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
```

### 4. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§–∞–π–ª—ã:**
- `docs/TELEGRAM_BOT_WEBHOOK_SETUP.md` - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ webhook
- `docs/QUICK_WEBHOOK_FIX.md` - –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- `docs/TELEGRAM_BOT_FIX_SUMMARY.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
‚úÖ src/app/api/telegram/webhook/route.ts       (–Ω–æ–≤—ã–π)
‚úÖ src/app/admin/bot/page.tsx                  (–æ–±–Ω–æ–≤–ª–µ–Ω)
‚úÖ env.example                                 (–æ–±–Ω–æ–≤–ª–µ–Ω)
‚úÖ docs/TELEGRAM_BOT_WEBHOOK_SETUP.md          (–Ω–æ–≤—ã–π)
‚úÖ docs/QUICK_WEBHOOK_FIX.md                   (–Ω–æ–≤—ã–π)
‚úÖ docs/TELEGRAM_BOT_FIX_SUMMARY.md            (–Ω–æ–≤—ã–π)
```

## –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞)

```
‚úÖ src/app/api/admin/bot-mode/route.ts         - API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞–º–∏
‚úÖ src/app/api/admin/bot-settings/route.ts     - API –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞
‚úÖ src/services/botSettingsService.ts          - –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
‚úÖ src/bot/index.ts                            - –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# .env
BOT_MODE=polling
BOT_AUTO_RESTART=true
```

–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ polling —Ä–µ–∂–∏–º–µ –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ URL.

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (Vercel)

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://your-app.vercel.app/admin/bot`
2. –ù–∞–∂–º–∏—Ç–µ "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Webhook"
3. –í–≤–µ–¥–∏—Ç–µ URL: `https://your-app.vercel.app/api/telegram/webhook`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Webhook —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω"

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Vercel Project Settings –¥–æ–±–∞–≤—å—Ç–µ:

```bash
BOT_MODE=webhook
BOT_WEBHOOK_URL=https://your-app.vercel.app/api/telegram/webhook
TELEGRAM_BOT_TOKEN=your-bot-token
BOT_AUTO_RESTART=true
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (redeploy).

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
```
https://your-app.vercel.app/admin/bot
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
- ‚úÖ –†–µ–∂–∏–º: Webhook
- ‚úÖ –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω
- ‚úÖ Webhook URL: https://...
- ‚úÖ –û–∂–∏–¥–∞—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: 0

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Telegram
–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:
```
/start
```

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (–Ω–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥).

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Telegram API
```bash
curl https://api.telegram.org/bot<TOKEN>/getWebhookInfo
```

–û—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "result": {
    "url": "https://your-app.vercel.app/api/telegram/webhook",
    "pending_update_count": 0
  }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ webhook —Ä–µ–∂–∏–º–∞

‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –Ω–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–æ 30 —Å–µ–∫—É–Ω–¥  
‚úÖ **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏** - —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram –ø–æ—Å—Ç–æ—è–Ω–Ω–æ  
‚úÖ **–õ—É—á—à–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Telegram  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  

## –û—Ç–ª–∏—á–∏—è –æ—Ç polling —Ä–µ–∂–∏–º–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Polling üîÑ | Webhook üîó |
|----------|-----------|-----------|
| –ó–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞ | –î–æ 30 —Å–µ–∫ | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è | –ù–µ—Ç | HTTPS URL |
| –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ | ‚ö†Ô∏è –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/bot`:
- üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏–∑ –ë–î –∏ Telegram API
- ‚ö†Ô∏è –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—à–∏–±–∫–∏ webhook (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üìà –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/bot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "–ê–∫—Ç–∏–≤–µ–Ω"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `pending_update_count` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0
4. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - –æ–Ω–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã

### Webhook –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç SSL

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `bot_settings`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

## API Endpoints

### `GET /api/admin/bot-mode`
–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º –∏ —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞

### `POST /api/admin/bot-mode`
–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –±–æ—Ç–∞ (polling ‚ÜîÔ∏è webhook)

### `POST /api/telegram/webhook`
Endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram

### `GET /api/admin/bot-settings`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/admin/bot`
3. ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ webhook —Ä–µ–∂–∏–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ Telegram
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìö [–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ webhook](./TELEGRAM_BOT_WEBHOOK_SETUP.md)
- ‚ö° [–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ](./QUICK_WEBHOOK_FIX.md)
- üìã [–≠—Ç–æ—Ç —Ñ–∞–π–ª](./TELEGRAM_BOT_FIX_SUMMARY.md)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** ‚úÖ –°–æ–∑–¥–∞–Ω–∞

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 16 –æ–∫—Ç—è–±—Ä—è 2025

